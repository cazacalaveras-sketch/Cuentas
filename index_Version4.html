<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Caja Parlante con Vueltos üíµ</title>
  <style>
    :root{ --card-bg:#fff; --accent:#8e44ad; --blue:#3498db; --green:#27ae60; --danger:#e74c3c; --muted:#666; }
    body{
      font-family: 'Segoe UI', Roboto, system-ui, -apple-system, sans-serif;
      background:#eef2f3;
      margin:0;padding:16px;
      max-width:720px;margin-left:auto;margin-right:auto;
      color:#2c3e50;
    }
    h1{ text-align:center; margin:6px 0 14px; font-size:20px; }
    .grid-productos{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
      margin-bottom:18px;
    }
    .card{
      background:var(--card-bg);
      border-radius:12px;
      padding:10px;
      text-align:center;
      box-shadow:0 4px 8px rgba(0,0,0,0.06);
      display:flex;
      flex-direction:column;
      gap:8px;
      align-items:center;
    }
    .product-emoji{
      font-size:44px;
      line-height:1;
      width:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      height:96px;
      border-radius:8px;
      background:linear-gradient(180deg,rgba(0,0,0,0.02),transparent);
    }
    .card h3{ font-size:15px; margin:0; }
    .precio{ color:var(--green); font-weight:700; font-size:1.02em; }
    .contador{
      font-size:24px; font-weight:700; color:#21303a;
      background:#f8f9fa; border-radius:8px; padding:6px 12px; min-width:56px;
      display:inline-flex; align-items:center; justify-content:center;
    }
    .controls{ display:flex; gap:8px; align-items:center; justify-content:center; }
    .btn-pulsador{
      background:var(--blue); color:#fff; border:none; padding:10px 12px; border-radius:10px;
      font-size:16px; font-weight:700; cursor:pointer;
    }
    .btn-mic{
      width:42px;height:42px;border-radius:50%;border:none;background:#ff4757;color:#fff;font-size:18px;
      display:inline-flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 2px 6px rgba(0,0,0,0.12);
    }
    .btn-mic.listening{ background:#2ed573; color:#063; transform:scale(1.03); box-shadow:0 6px 14px rgba(46,213,115,0.18); }
    .mic-note{ font-size:12px; color:var(--muted); min-height:18px; text-align:center; margin-top:2px; }
    .btn-total{
      width:100%; padding:14px; background:var(--accent); color:#fff; border-radius:12px; border:none; font-size:18px; font-weight:700; cursor:pointer; margin-bottom:10px;
    }
    #seccion-pago{ display:none; background:var(--card-bg); padding:16px; border-radius:12px; border:2px solid var(--accent); box-shadow:0 -4px 10px rgba(0,0,0,0.04); margin-bottom:10px; }
    .pago-row{ display:flex; gap:8px; align-items:center; justify-content:center; margin-bottom:6px; }
    .input-pago{ width:66%; padding:10px; font-size:20px; text-align:center; border-radius:10px; border:2px solid #ccc; }
    .btn-cambio{ width:100%; padding:12px; background:var(--green); color:#fff; font-size:18px; border-radius:10px; border:none; cursor:pointer; margin-top:6px; }
    #resultado-cambio{ display:none; text-align:center; font-size:18px; font-weight:700; color:#c0392b; margin-top:8px; padding:8px; border-radius:8px; background:#fff0f0; }
    .btn-limpiar{ width:100%; padding:12px; background:var(--danger); color:#fff; border:none; border-radius:8px; font-size:15px; cursor:pointer; margin-top:8px; }
    #resumen-texto{ display:none; background:var(--card-bg); padding:10px; border-radius:8px; margin-bottom:8px; font-size:14px; color:#444; }
    @media(max-width:520px){ .grid-productos{ grid-template-columns:1fr; } .input-pago{ width:58%; } .product-emoji{ height:84px; font-size:40px } }
  </style>
</head>
<body>
  <h1>üõí Caja R√°pida</h1>

  <div class="grid-productos" id="productos-grid" aria-live="polite"></div>

  <div id="resumen-texto" aria-live="polite"></div>

  <button class="btn-total" id="btn-decir-total">üó£Ô∏è DECIR TOTAL</button>

  <div id="seccion-pago" aria-live="polite">
    <div style="text-align:center;font-size:16px;margin-bottom:6px;">¬øCon cu√°nto paga? üíµ</div>
    <div class="pago-row">
      <input type="text" id="input-dinero-cliente" class="input-pago" placeholder="$" inputmode="numeric" aria-label="Monto que entrega el cliente">
      <button class="btn-mic" id="btn-mic-pago" title="Dictar monto de pago" aria-label="Dictar monto de pago">üé§</button>
    </div>
    <div id="mic-note-pago" class="mic-note" aria-live="polite"></div>
    <button class="btn-cambio" id="btn-calcular-cambio">üßÆ CALCULAR CAMBIO</button>
    <div id="resultado-cambio" role="status" aria-live="polite"></div>
  </div>

  <button class="btn-limpiar" id="btn-limpiar">üóëÔ∏è Nueva Venta (Borrar)</button>

  <script>
    // --- Productos usando emojis en lugar de im√°genes ---
    const productos = [
      { id:0, nombre:"Gaseosa Peque√±a", precio:2000, cantidad:0, emoji:"ü•§" },
      { id:1, nombre:"Gaseosa Litro", precio:4000, cantidad:0, emoji:"üçã" },
      { id:2, nombre:"Cerveza", precio:2800, cantidad:0, emoji:"üç∫" },
      { id:3, nombre:"Cerveza Litro", precio:6000, cantidad:0, emoji:"üçª" },
      { id:4, nombre:"Papas", precio:1800, cantidad:0, emoji:"üì¶" }
    ];

    const nf = new Intl.NumberFormat('es-CO', { maximumFractionDigits: 0 });
    let totalActual = 0;

    // SpeechRecognition support (may be null on some browsers)
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition || null;
    const recognitionMap = {}; // active recognizers keyed by product id or 'pago'

    // Render productos (emoji)
    function renderProductos(){
      const grid = document.getElementById('productos-grid');
      grid.innerHTML = '';
      productos.forEach(p => {
        const card = document.createElement('article');
        card.className = 'card';
        card.innerHTML = `
          <div class="product-emoji" aria-hidden="true">${p.emoji}</div>
          <h3>${p.nombre}</h3>
          <div class="precio">$${nf.format(p.precio)}</div>
          <div class="contador" id="count-${p.id}">${p.cantidad}</div>
          <div class="controls">
            <button class="btn-pulsador" data-action="inc" data-id="${p.id}" aria-label="Agregar una unidad">+ 1</button>
            <button class="btn-mic" title="Dictar cantidad" aria-label="Dictar cantidad" data-id="${p.id}">üé§</button>
          </div>
          <div class="mic-note" id="mic-note-${p.id}" aria-live="polite"></div>
        `;
        grid.appendChild(card);
      });

      // disable mic buttons if unsupported
      if(!SpeechRecognition){
        document.querySelectorAll('.btn-mic').forEach(b=>{
          b.disabled = true;
          b.title = 'Dictado no soportado en este navegador';
          const note = document.getElementById(`mic-note-${b.dataset.id}`);
          if(note) note.innerText = 'Dictado no soportado';
        });
        const payMic = document.getElementById('btn-mic-pago');
        if(payMic){ payMic.disabled = true; payMic.title = 'Dictado no soportado'; document.getElementById('mic-note-pago').innerText = 'Dictado no soportado'; }
      }
    }

    renderProductos();

    // Delegated click handler (increment and mic)
    document.getElementById('productos-grid').addEventListener('click', (e)=>{
      const btn = e.target.closest('button');
      if(!btn) return;
      const action = btn.dataset.action;
      const idAttr = btn.dataset.id;
      if(typeof idAttr === 'undefined') return;
      const id = parseInt(idAttr,10);
      if(action === 'inc') changeCantidad(id, +1);
      if(btn.classList.contains('btn-mic')) toggleDictation(id, btn);
    });

    function changeCantidad(id, delta){
      productos[id].cantidad = Math.max(0, productos[id].cantidad + delta);
      updateCountUI(id);
      ocultarPago();
    }

    function updateCountUI(id){
      const el = document.getElementById(`count-${id}`);
      if(el) el.innerText = productos[id].cantidad;
    }

    // Utility: stop all active recognizers (avoid conflicts)
    function stopAllDictations(){
      for(const key in recognitionMap){
        try {
          const rec = recognitionMap[key];
          if(rec && typeof rec.stop === 'function'){
            // remove handlers to avoid double-calling
            rec.onresult = rec.onend = rec.onerror = null;
            try{ rec.stop(); } catch(e){}
          }
        } catch(e){}
        // remove UI state for mic buttons
        const btn = (key === 'pago') ? document.getElementById('btn-mic-pago') : document.querySelector(`.btn-mic[data-id="${key}"]`);
        if(btn) btn.classList.remove('listening');
        delete recognitionMap[key];
      }
    }

    // Toggle product dictation
    function toggleDictation(id, btn){
      if(!SpeechRecognition) return alert('Dictado por voz no soportado en este navegador.');
      if(recognitionMap[id]) {
        stopDictation(id);
        return;
      }
      // ensure no other recognizer is active
      stopAllDictations();
      startDictation(id, btn);
    }

    function startDictation(id, btn){
      if(!btn) btn = document.querySelector(`.btn-mic[data-id="${id}"]`);
      btn.classList.add('listening');
      const note = document.getElementById(`mic-note-${id}`);
      if(note) note.innerText = 'Escuchando... di la cantidad (ej: "tres" o "3")';
      // cancel any speech synthesis (some browsers block recognition if TTS active)
      try { window.speechSynthesis.cancel(); } catch(e){}
      const rec = new SpeechRecognition();
      rec.lang = 'es-CO';
      rec.interimResults = false;
      rec.maxAlternatives = 1;

      rec.onresult = (ev) => {
        try {
          const transcript = ev.results[0][0].transcript.trim().toLowerCase();
          const parsed = parseNumberFromSpeech(transcript);
          if(Number.isFinite(parsed) && parsed >= 0){
            productos[id].cantidad = parsed;
            updateCountUI(id);
            speakConfirmQuantity(id, parsed);
            ocultarPago();
            if(note) note.innerText = `Cantidad ajustada a ${parsed}`;
          } else {
            if(note) note.innerText = `No entend√≠ cantidad: "${transcript}". Intenta decir un n√∫mero.`;
            speak(`No entend√≠ la cantidad, por favor repite el n√∫mero.`);
          }
        } catch(e){
          if(note) note.innerText = 'Error procesando la respuesta.';
        }
      };

      rec.onerror = (e) => {
        console.warn('SpeechRecognition product error', e);
        if(e && e.error === 'not-allowed') {
          if(note) note.innerText = 'Permiso de micr√≥fono denegado.';
          alert('Permiso de micr√≥fono denegado. Revisa los permisos del navegador.');
        } else {
          if(note) note.innerText = 'Error de dictado. Intenta de nuevo.';
        }
        speak('Hubo un error con el dictado.');
      };

      rec.onend = () => {
        // cleanup UI and map
        stopDictation(id);
      };

      recognitionMap[id] = rec;
      try {
        rec.start();
      } catch(err){
        console.warn('start recognition failed', err);
        if(note) note.innerText = 'No se pudo iniciar el dictado.';
        // cleanup
        stopDictation(id);
      }
    }

    function stopDictation(id){
      const rec = recognitionMap[id];
      const btn = document.querySelector(`.btn-mic[data-id="${id}"]`);
      if(rec){
        try{ rec.onresult = rec.onend = rec.onerror = null; rec.stop(); } catch(e){}
        delete recognitionMap[id];
      }
      if(btn) btn.classList.remove('listening');
      const note = document.getElementById(`mic-note-${id}`);
      if(note && note.innerText && note.innerText.startsWith('Escuchando')) note.innerText = '';
    }

    // parse numbers from Spanish speech (digits or words up to thousands)
    function parseNumberFromSpeech(text){
      if(!text) return NaN;
      // digits first
      const digitsMatch = text.match(/(-?\d+)/);
      if(digitsMatch) return parseInt(digitsMatch[1],10);

      // simple word map
      const lex = {
        'cero':0,'un':1,'uno':1,'una':1,'dos':2,'tres':3,'cuatro':4,'cinco':5,'seis':6,'siete':7,'ocho':8,'nueve':9,
        'diez':10,'once':11,'doce':12,'trece':13,'catorce':14,'quince':15,'dieciseis':16,'diecis√©is':16,'diecisiete':17,'dieciocho':18,'diecinueve':19,'veinte':20,
        'veintiuno':21,'veintidos':22,'veintid√≥s':22,'veintitres':23,'veintitr√©s':23,'treinta':30,'cuarenta':40,'cincuenta':50
      };

      const cleaned = text.replace(/[^a-z√°√©√≠√≥√∫√º√±\s]/g,'').trim();
      if(lex.hasOwnProperty(cleaned)) return lex[cleaned];

      const words = cleaned.split(/\s+/);
      for(const w of words){
        if(lex.hasOwnProperty(w)) return lex[w];
      }

      // pattern "treinta y dos", "veinte y tres"
      const complexMatch = cleaned.match(/(treinta|cuarenta|cincuenta|veinte|veinti)\s*(y\s*)?([a-z]+)/);
      if(complexMatch){
        const tens = complexMatch[1];
        const unit = complexMatch[3];
        const tensMap = {'veinte':20,'veinti':20,'treinta':30,'cuarenta':40,'cincuenta':50};
        const t = tensMap[tens] || 0;
        if(lex[unit]) return t + lex[unit];
      }
      // fallback: check any number word present
      for(const k in lex) if(cleaned.includes(k)) return lex[k];
      return NaN;
    }

    // Speech synthesis helper
    function speak(text){
      try {
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(text);
        u.lang = 'es-CO';
        u.rate = 0.95;
        window.speechSynthesis.speak(u);
      } catch(e){}
    }

    function speakConfirmQuantity(id, qty){
      const prod = productos[id];
      if(!prod) return;
      const txt = `Cantidad de ${prod.nombre} establecida en ${qty} unidades.`;
      speak(txt);
    }

    // ----- Payment mic logic (with same safety measures) -----
    const pagoKey = 'pago';
    const payMicBtn = document.getElementById('btn-mic-pago');
    const payMicNote = document.getElementById('mic-note-pago');

    if(payMicBtn){
      payMicBtn.addEventListener('click', ()=> togglePaymentDictation());
      if(!SpeechRecognition){
        payMicBtn.disabled = true;
        payMicBtn.title = 'Dictado no soportado';
        if(payMicNote) payMicNote.innerText = 'Dictado no soportado';
      }
    }

    function togglePaymentDictation(){
      if(!SpeechRecognition) return alert('Dictado por voz no soportado en este navegador.');
      if(recognitionMap[pagoKey]) { stopPaymentDictation(); return; }
      // stop any other dictation first
      stopAllDictations();
      startPaymentDictation();
    }

    function startPaymentDictation(){
      const btn = document.getElementById('btn-mic-pago');
      if(btn) btn.classList.add('listening');
      if(payMicNote) payMicNote.innerText = 'Escuchando monto... di, por ejemplo, "diez mil" o "15000"';
      try { window.speechSynthesis.cancel(); } catch(e){}

      const rec = new SpeechRecognition();
      rec.lang = 'es-CO';
      rec.interimResults = false;
      rec.maxAlternatives = 1;

      rec.onresult = (ev) => {
        try {
          const transcript = ev.results[0][0].transcript.trim().toLowerCase();
          const parsed = parseMoneyFromSpeech(transcript);
          if(Number.isFinite(parsed) && parsed >= 0){
            document.getElementById('input-dinero-cliente').value = nf.format(parsed);
            if(payMicNote) payMicNote.innerText = `Pago reconocido: $${nf.format(parsed)}`;
            speak(`Registrado ${nf.format(parsed)} pesos.`);
          } else {
            if(payMicNote) payMicNote.innerText = `No entend√≠ monto: "${transcript}". Intenta decir un n√∫mero.`;
            speak('No entend√≠ el monto, por favor repite el n√∫mero.');
          }
        } catch(e){
          if(payMicNote) payMicNote.innerText = 'Error procesando la respuesta.';
        }
      };

      rec.onerror = (e) => {
        console.warn('Payment SpeechRecognition error', e);
        if(e && e.error === 'not-allowed'){
          if(payMicNote) payMicNote.innerText = 'Permiso de micr√≥fono denegado.';
          alert('Permiso de micr√≥fono denegado. Revisa los permisos del navegador.');
        } else {
          if(payMicNote) payMicNote.innerText = 'Error de dictado. Intenta de nuevo.';
        }
        speak('Hubo un error con el dictado.');
      };

      rec.onend = () => stopPaymentDictation();

      recognitionMap[pagoKey] = rec;
      try { rec.start(); } catch(err){
        console.warn('start payment rec failed', err);
        if(payMicNote) payMicNote.innerText = 'No se pudo iniciar el dictado.';
        stopPaymentDictation();
      }
    }

    function stopPaymentDictation(){
      const rec = recognitionMap[pagoKey];
      const btn = document.getElementById('btn-mic-pago');
      if(rec){
        try{ rec.onresult = rec.onend = rec.onerror = null; rec.stop(); } catch(e){}
        delete recognitionMap[pagoKey];
      }
      if(btn) btn.classList.remove('listening');
      if(payMicNote && payMicNote.innerText && payMicNote.innerText.startsWith('Escuchando')) payMicNote.innerText = '';
    }

    // --- Money parsing (returns integer pesos, no centavos) ---
    function parseDinero(str){
      if(typeof str === 'number') return Math.round(str);
      if(!str) return NaN;
      let s = String(str).trim().replace(/[^\d,.-]/g,'');
      const hasComma = s.includes(','), hasDot = s.includes('.');
      if(hasComma && hasDot){
        if(s.lastIndexOf(',') > s.lastIndexOf('.')) s = s.replace(/\./g,'').replace(',','.');
        else s = s.replace(/,/g,'');
      } else if(hasDot){
        const parts = s.split('.');
        if(parts[1] && parts[1].length === 3) s = s.replace(/\./g,'');
      } else if(hasComma){
        const parts = s.split(',');
        if(parts[1] && parts[1].length === 3) s = s.replace(/,/g,'');
        else s = s.replace(/,/g,'.');
      }
      const n = parseFloat(s);
      return isNaN(n) ? NaN : Math.round(n);
    }

    function parseMoneyFromSpeech(text){
      if(!text) return NaN;
      let t = text.toLowerCase();
      t = t.replace(/\bpesos?\b/g,'').replace(/\bcop\b/g,'').replace(/\bcentavos?\b/g,'');
      t = t.replace(/\bcon\b/g,' ').replace(/\by\b/g,' ').replace(/\+/g,' ').replace(/\s+/g,' ').trim();
      const p1 = parseDinero(t);
      if(!isNaN(p1)) return p1;
      const nw = numberWordsToNumber(t);
      if(!isNaN(nw) && nw >= 0) return Math.round(nw);
      const digits = t.match(/(\d+)/g);
      if(digits) return parseInt(digits.join(''),10);
      return NaN;
    }

    // Simple number-words parser (supports units, tens, hundreds, mil, mill√≥n)
    function numberWordsToNumber(text){
      if(!text) return NaN;
      const mapUnits = {'cero':0,'un':1,'uno':1,'una':1,'dos':2,'tres':3,'cuatro':4,'cinco':5,'seis':6,'siete':7,'ocho':8,'nueve':9};
      const mapTeens = {'diez':10,'once':11,'doce':12,'trece':13,'catorce':14,'quince':15,'dieciseis':16,'diecis√©is':16,'diecisiete':17,'dieciocho':18,'diecinueve':19};
      const mapTens = {'veinte':20,'veinti':20,'treinta':30,'cuarenta':40,'cincuenta':50,'sesenta':60,'setenta':70,'ochenta':80,'noventa':90};
      const mapHundreds = {'cien':100,'ciento':100,'doscientos':200,'trescientos':300,'cuatrocientos':400,'quinientos':500,'seiscientos':600,'setecientos':700,'ochocientos':800,'novecientos':900};

      let s = text.normalize('NFD').replace(/[\u0300-\u036f]/g,"");
      s = s.replace(/-/g,' ').replace(/,/g,' ').trim();
      const tokens = s.split(/\s+/);

      let total = 0, current = 0;
      for(const token of tokens){
        if(token === 'y' || token === '') continue;
        if(mapUnits[token] !== undefined){ current += mapUnits[token]; continue; }
        if(mapTeens[token] !== undefined){ current += mapTeens[token]; continue; }
        if(mapTens[token] !== undefined){ current += mapTens[token]; continue; }
        if(mapHundreds[token] !== undefined){ current += mapHundreds[token]; continue; }
        if(token.startsWith('veinti')){ const rest = token.slice(6); if(rest && mapUnits[rest]!==undefined) current += 20 + mapUnits[rest]; else current += 20; continue; }
        if(token === 'mil'){ if(current === 0) current = 1; total += current * 1000; current = 0; continue; }
        if(token === 'millon' || token === 'millones' || token === 'mill√≥n'){ if(current === 0) current = 1; total += current * 1000000; current = 0; continue; }
        const digits = token.match(/\d+/);
        if(digits){ current += parseInt(digits.join(''),10); continue; }
      }
      const result = total + current;
      return (isNaN(result) || result === 0) ? (tokens.includes('cero') ? 0 : NaN) : result;
    }

    // ----- Total / cambio logic -----
    document.getElementById('btn-decir-total').addEventListener('click', ()=>{
      window.speechSynthesis.cancel();
      totalActual = 0;
      let textoVoz = 'Lleva: ';
      let resumenHTML = '<b>Detalle:</b><br>';
      let hayItems = false;
      productos.forEach(p=>{
        if(p.cantidad > 0){
          const subtotal = p.cantidad * p.precio;
          totalActual += subtotal;
          resumenHTML += `- ${p.cantidad} x ${p.nombre} ($${nf.format(subtotal)})<br>`;
          hayItems = true;
        }
      });
      if(!hayItems){ speak('No has marcado nada.'); return; }
      resumenHTML += `<br><b>TOTAL: $${nf.format(totalActual)}</b>`;
      document.getElementById('resumen-texto').innerHTML = resumenHTML;
      document.getElementById('resumen-texto').style.display = 'block';
      textoVoz += productos.filter(p=>p.cantidad>0).map(p=>`${p.cantidad} ${p.nombre}`).join(', ') + `. El total es ${nf.format(totalActual)} pesos.`;
      speak(textoVoz);
      document.getElementById('seccion-pago').style.display = 'block';
      document.getElementById('input-dinero-cliente').value = '';
      document.getElementById('input-dinero-cliente').focus();
      document.getElementById('seccion-pago').scrollIntoView({behavior:'smooth'});
    });

    document.getElementById('btn-calcular-cambio').addEventListener('click', ()=>{
      if(totalActual <= 0){ speak('Calcula el total antes de ingresar pago.'); return; }
      const raw = document.getElementById('input-dinero-cliente').value;
      const pago = parseDinero(raw);
      if(isNaN(pago)){ speak('Escribe con cu√°nto paga primero.'); mostrarResultado('Escribe con cu√°nto paga primero','warn'); return; }
      if(pago < totalActual){ const falta = totalActual - pago; speak(`Faltan ${nf.format(falta)} pesos.`); mostrarResultado(`‚ö†Ô∏è FALTAN $${nf.format(falta)}`,'warn'); return; }
      const cambio = Math.round(pago - totalActual);
      mostrarResultado(`‚úÖ CAMBIO: $${nf.format(cambio)}`,'ok');
      speak(`El cambio es de ${nf.format(cambio)} pesos.`);
    });

    function mostrarResultado(texto, tipo){
      const d = document.getElementById('resultado-cambio');
      d.innerText = texto;
      d.style.display = 'block';
      d.className = tipo === 'ok' ? 'resultado-ok' : 'resultado-warn';
    }

    // limpiar venta
    document.getElementById('btn-limpiar').addEventListener('click', ()=>{
      if(!confirm('¬øBorrar cuenta y empezar nueva?')) return;
      window.speechSynthesis.cancel();
      productos.forEach((p,i)=>{ p.cantidad = 0; updateCountUI(i); });
      ocultarPago();
      totalActual = 0;
      productos.forEach(p=>{
        const note = document.getElementById(`mic-note-${p.id}`);
        if(note) note.innerText = '';
      });
      if(payMicNote) payMicNote.innerText = '';
      stopAllDictations();
    });

    function ocultarPago(){
      document.getElementById('seccion-pago').style.display = 'none';
      document.getElementById('resultado-cambio').style.display = 'none';
      document.getElementById('resumen-texto').style.display = 'none';
    }

    // initialize counts UI
    productos.forEach(p=> updateCountUI(p.id));
  </script>
</body>
</html>